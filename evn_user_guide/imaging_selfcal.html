<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="User Guide of EVN data reduction">
    <meta name="author" content="Benito Marcote">

    <title>EVN User Guide</title>
    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- MetisMenu CSS -->
    <link href="vendor/metisMenu/metisMenu.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="dist/css/sb-admin-2.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<style type="text/css">
	    pre{
		    display: block;
		    font-family: monospace;
		    padding: 9.5px;
		    margin: 0 0 10px;
		    font-size: 13px;
		    line-height: 1.42857143;
		    color: #333;
		    word-break: break-all;
		    word-wrap: break-word;
		    background-color: #dff0d8;
		    border: 0px solid #ccc;
		    border-radius: 4px;
		}
	</style>
</head>
<body>
    <div id="wrapper">
        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="user_guide.html">EVN Data Reduction</a>
            </div>
            <!-- /.navbar-header -->
            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li>
                            <a href="index.html#intro">Introduction</a>
                        </li>
                        <li>
                            <a href="index.html#obtaining_data">Obtaining the data<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="index.html#data_archive">EVN Data Archive</a>
                                </li>
                                <li>
                                    <a href="index.html#import_data">Loading data into AIPS</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                        <li>
                            <a href="index.html#inspecting_data">Inspecting the data</a>
                        </li>
                        <li>
                            <a href="index.html#calibration">Calibration<span class="fa arrow"></span></a></span></a>
                            <ul class="nav nav-second-level">
	                            <li>
                                    <a href="index.html#ionospheric_cor">Ionospheric corrections</a>
                                </li>
                                <li>
                                    <a href="index.html#instr_delay">Instrumental delays</a>
                                </li>
                                <li>
                                    <a href="index.html#freq_phase_cal">Freq. and phase calibration</a>
                                </li>
                                <li>
                                    <a href="index.html#bandpass">Bandpass calibration</a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a href="index.html#split">Split and storage</a>
                        </li>
                        <li>
                        	<a href="index.html#imaging_aips">Initial imaging<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="index.html#imaging_aips1">Cleaning and imaging</a>
                                </li>
                                <li>
                                    <a href="index.html#statistics">Statistics</a>
                                </li>
							</ul>
                            <!-- /.nav-second-level -->
                        </li>
                        <li>
                        	<a href="imaging_selfcal.html">Imaging and self-calibration<span class="fa arrow"></span></a>
							<ul class="nav nav-second-level">
								<li>
									<a href="#intro-selfcal">Introduction</a>
								</li>
								<li>
									<a href="#load-inspect">Load and inspect</a>
								</li>
								<li>
									<a href="#imaging-difmap">Imaging</a>
								</li>
								<li>
									<a href="#selfcal-difmap">Self-calibration</a>
								</li>
								<li>
									<a href="#transfer-solutions">Correcting the target</a>
								</li>
							</ul>
                        </li>
                        <!--<li>
                        	<a href="spectral_line.html">Spectral line</a>
                        </li>-->
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <!-- Page Content -->
        <div id="page-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-10">
                        <h1 class="page-header" id="intro-selfcal">Advanced imaging and self-calibration</h1>
						
						<p>
							If you have followed the previous sections you should have ended up with a calibrated data set for all your sources (all of them stored in separated SPLIT files). Although the imaging process can be perfectly done within AIPS, as explained previously, Difmap allows you to perform a more dynamic imaging/calibration of the data. Its approach usually produces a easier way to perform the last and more refined steps in the calibration of an EVN dataset (basically flagging, imaging with different weightings, and self-calibration). For this reason, in this section we will describe how to improve the final EVN images by working with the data in both AIPS and Difmap and which steps will produce a better calibration on the target source. Although the tutorial is focused for phase-referencing observations, it can also be applied for other techniques.
						</p>
						<p>
							This guide assumes that you have a small knowledge of how <a href="ftp://ftp.astro.caltech.edu/pub/difmap/difmap.html">Difmap</a> works. Otherwise, we recommend to follow a more detailed tutorial, as the one <a href="http://brandeisastro.pbworks.com/w/page/14977088/Difmap%20Tutorial">done by Doug Gobeille at Brandeis University</a>.
							An exhaustive manual is also provided by ESO <a href="ftp://ftp.eso.org/scisoft/scisoft4/sources/difmap/help.ps.Z">in this link</a> (PS file), with a detailed explanation of all the tasks available in Difmap.
						</p>

						<h3 class="page-header" id="procedure">How to improve your calibration</h3>
						<p>
							In the previous tutorial we have produced a standard calibration of your data by running fringe on your strongest sources, bandpass calibrating the data, and extrapolating the solutions to your target source. However, sometimes the obtained solutions are not optimal and some stations can exhibit a systematic offset in amplitude due to a wrong calibration (we remind you that in the EVN we have a wide variety of stations, with different capabilities, sizes, and sensitivities).
						</p>
						<p>
							Because of that, we can improve the calibration if we self-calibrate the data using one strong source that has been observed regularly during the whole observation. In phase-referencing sessions this one should be the phase calibrator. Given that this source should be strong enough, close to our target source, and observed every few minutes, we can get much better solutions self-calibrating it and then extrapolating these solutions again to our target source. In those cases where your target source is bright enough, we can directly conduct this self-calibration directly on it, but in that case note that the absolute position of your source is lost (no astrometric studies can be performed).
						</p>
						<p>
							The mentioned procedure will be carried out as follows:
							<ul>
								<li> Load the phase-calibrator data into Difmap and inspect the data
								<li> Produce an initial image of the source
								<li> Self-calibrate the data based on this image
								<li> Repeat this loop until we obtain accurate solutions
								<li> Save and import the data again into AIPS
								<li> Create a SN table containing the self-calibration solutions and extrapolate them to the target source
								<li> Finally image the target source
							</ul>
						</p>

						<h1 class="page-header" id="load-inspect">Load and inspect the data</h1>
						<p>
							During the last steps of the previous tutorial we exported the SPLIT files to the hard disk with <tt>FITTP</tt>. Hence we have the phase-calibrator data (calibrated) as a UVFITS file. We can then open Difmap and load these data into it (contrary to AIPS, Difmap works with the UVFITS files on the fly):
						</p>
						<div class="row">
						<div class="col-lg-5">
						<div class="well well-sm">
							<tt>
								difmap<br>
								obs <em>filename-phasecal-split.uvfits</em><br>
								select PI<br>
							</tt>
						</div>
						</div>
						<div class="col-lg-7">
						<div class="panel panel-warning">
							<div class="panel-heading">
								Be careful!
							</div>
							<div class="panel-body">
								Difmap loads all the data into memory. This produces that if the data size is too large and your resources are low, all the data cannot be loaded. For such reason you have the <tt>select</tt> command to select a subset of your data. In the general case, the EVN data files are typically small enough to not produce issues.<br><br>
								<tt>select</tt> allows you to select which polarization is going to be loaded (I, Q, U, RR,...) and optionally the number of subbands to be loaded (otherwise all of them). By default Difmap only produces I stokes if both, RR and LL are available. We can avoid this behavior selecting <tt>select PI</tt> (meaning pseudo-I). In this case Difmap will compute I stokes and will keep the data (RR or LL) for those stations with only one polarization.
							</div>
						</div>
						</div>
						</div>
						
						<p>
							In Difmap there are several tasks to plot your data and interact with them. The most common ones are:
							<ul>
								<li> <tt>radplot</tt>: shows the amplitudes/phases versus <em>uv</em>-distance.
								<li> <tt>vplot</tt>: amplitudes/phases versus time per baseline and IF. Specially useful to flag RFI that is only present in some baselines/stations at particular times.
								<li> <tt>uvplot</tt>: <em>uv</em>-coverage.
								<li> <tt>projplot</tt>: same as <tt>radplot</tt> but considering the position angle, and you can rotate to see the data from different projected angles.
							</ul>
							We note that if you press a number between 1 and 3 you obtain a plot of amplitudes, phases, or amplitudes and phases, respectively. Additionally you can flag data by clicking with the mouse (it flags the closest point) or by making a flagging area (clicking the <tt>C</tt> character and moving the mouse).
						</p>

						<h1 class="page-header" id="imaging-difmap">Imaging with Difmap</h1>
						
						<p>
							Once we have a dataset free of RFI 
						</p>
						
						<h1 class="page-header" id="selfcal-difmap">Self-calibration</h1>
						<h1 class="page-header" id="transfer-solutions">Correcting the target source</h1>


						<!-- ASTROMETRIC IMPLICATIONS -->
                   </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <!-- Metis Menu Plugin JavaScript -->
    <script src="vendor/metisMenu/metisMenu.min.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src="dist/js/sb-admin-2.js"></script>
	<script>
    // tooltip demo
    $('.popover-buttons').tooltip({
        selector: "[data-toggle=tooltip]",
        container: "body"
    })
    // popover demo
    $("[data-toggle=popover]")
        .popover()
    </script>
</body>

</html>
